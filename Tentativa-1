import pyautogui
import speech_recognition as sr
import pyttsx3
import datetime
import wikipedia
import wikipediaapi
import pywhatkit
import time
import webbrowser
import sys
import tkinter as tk
from tkinter import *
def search_wikipedia(keyword):
    wiki_wiki = wikipediaapi.Wikipedia('pt')
    page_py = wiki_wiki.page(keyword)
    if page_py.exists():
        print(f"Encontrado: {page_py.title}")
        print("Conteúdo:")
        print(page_py.text[:200])  # Exibe os primeiros 200 caracteres do conteúdo
    else:
        print(f"{keyword} não encontrado na Wikipedia.")
    search_wikipedia('Palavra')
def Chat_voz():
    # Habilita o microfone para ouvir o usuario
    microfone = sr.Recognizer()
    maquina = pyttsx3.init()
    concluido = False
    Opera_aberto = False
    while True:
        class EncerrarTodosOsLoops(Exception):
            pass
        with sr.Microphone() as source:
            # Chama a funcao de reducao de ruido disponivel na speech_recognition
            microfone.adjust_for_ambient_noise(source)
            # Avisa ao usuario que esta pronto para ouvir
            print("Diga alguma coisa: ")
            # Armazena a informacao de audio na variavel
            audio = microfone.listen(source)
        try:
            # Passa o audio para o reconhecedor de padroes do speech_recognition
            frase = microfone.recognize_google(audio, language='pt-BR')
            # Após alguns segundos, retorna a frase falada;
            print("Você disse: " + frase)
            if "darling" in frase:
                comando = frase.replace('darling', '')
                maquina.say(comando)
                maquina.runAndWait()
                time.sleep(3.0)
                while True:
                    with sr.Microphone() as source:
                        microfone.adjust_for_ambient_noise(source)
                        if concluido == False:
                            print("Oque você deseja pesquisar? ")
                            maquina.say("Oque você deseja?:")
                        elif concluido == True:
                            maquina.say("Deseja mais alguma coisa:")
                        maquina.runAndWait()
                        audio = microfone.listen(source)
                    try:
                        frase_2 = microfone.recognize_google(audio, language='pt-BR')
                        print("Ultimo comando dado " + frase_2)
                        if 'horas' in frase_2:
                            hora = datetime.datetime.now().strftime('%H:%M')
                            maquina.say("Agora são" + hora)
                            maquina.runAndWait()
                        if Opera_aberto == False:
                            if any(keyword in frase_2.lower() for keyword in ["opera", "ópera", "opera gx", "google"]):
                                pyautogui.press("win")
                                if any(keyword in frase_2.lower() for keyword in ["opera", "ópera", "opera gx"]):
                                    pyautogui.write("opera")
                                    Opera_aberto = True
                                elif "google" in frase_2.lower():
                                    pyautogui.write("Google")
                                time.sleep(1.9)
                                pyautogui.press("enter")
                                time.sleep(1.5)
                                pyautogui.press("Ctrl" + "L")
                                time.sleep(2.5)
                                if "youtube" in frase_2.lower():
                                    pyautogui.write("YouTube")
                                    time.sleep(1.9)
                                    pyautogui.press("enter")
                                    time.sleep(4.5)
                                    while concluido is False:
                                        with sr.Microphone() as source:
                                            microfone.adjust_for_ambient_noise(source)
                                            print("Qual video você deseja ver?")
                                            maquina.say("Qual video você deseja ver?")
                                            maquina.runAndWait()
                                            audio = microfone.listen(source)
                                            time.sleep(2)
                                        try:
                                            frase_3 = microfone.recognize_google(audio, language='pt-BR')
                                            pyautogui.click(-570, -158)
                                            if any(keyword in frase_3.lower() for keyword in ["procurar vídeo", "procurar por", "procure vídeo"]):
                                                pyautogui.click(-570, -158)
                                                procurar = frase_3.replace('procure videos' or 'procurar por' or 'procure vídeo', '')
                                                pyautogui.write(procurar)
                                                time.sleep(1.9)
                                                pyautogui.press("enter")
                                                concluido = True
                                                break
                                            else:
                                                procurar = frase_3
                                                pyautogui.write(procurar)
                                                time.sleep(1.9)
                                                pyautogui.press("enter")
                                                concluido = True
                                                break
                                        except Exception as e:
                                            print(f"Erro inesperado: {e}")
                                        finally:
                                            print("Executando código no bloco finally(3).")
                        elif Opera_aberto == True:
                            if any(keyword in frase_2.lower() for keyword in ["faça uma pesquisa", "busque", "pesquise"]):
                                procurar = frase_2.replace('faça uma busca por' or 'busque', '')
                                pesquisa_url = f"https://www.google.com/search?q={'+'.join(procurar.split())}"
                                webbrowser.open(pesquisa_url)
                                concluido = True
                        elif any(keyword in frase_2.lower() for keyword in ["Não","Nao","encerrar", "encerre"]):
                            print("===" * 10)
                            print("Finalizando programa")
                            raise EncerrarTodosOsLoops
                            sys.exit()
                    except Exception as e:
                        print(f"Erro inesperado: {e}")
                    finally:
                        print("Executando comando(2).")
        except Exception as e:
            print(f"Erro inesperado: {e}")
        except EncerrarTodosOsLoops:
            print("Encerrando todos os loops.")
        finally:
            print("Executando comando(1).")

janela = tk.Tk()
botao = tk.Button(janela, text='Iniciar', command = Chat_voz)
botao.grid(row=1, column=2)
janela.mainloop()
